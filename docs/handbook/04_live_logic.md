## Лайв‑логика: выбор монет, ордера, риск

Главный модуль: `src/passivbot.py`.

### Цикл исполнения
Высокоуровнево каждый «тик» делает:
1) Обновление данных: позиции, ордера, цены, кеши OHLCV
2) Формирование списков монет:
   - `approved_coins`/`ignored_coins` + внешние файлы
   - фильтр по «возрасту» монеты (`minimum_coin_age_days`)
   - фильтр по минимальному размеру ордера (`filter_by_min_effective_cost`)
3) Если активен forager:
   - сортировка по объёму (исключение нижних `filter_volume_drop_pct`)
   - расчёт «шумности»: `mean((high - low) / close)` на окне
   - выбор топ‑`n_positions` монет
4) Постановка/снятие/обновление лимитных ордеров входа/выхода
5) Контроль лимитов экспозиции и процедуры `unstuck`

### Выбор монет (forager)
Функции (по смыслу):
- фильтры: возраст, min_effective_cost
- `calc_volumes()` → обрезка нижних по объёму
- `calc_noisiness()` → argsort по «шумности»
- `get_max_n_positions()` → итоговое число монет

Чтобы торговать не одной монетой:
- увеличьте `bot.long.n_positions`
- при необходимости ослабьте `filter_volume_drop_pct`
- убедитесь, что хватает min_cost для создаваемых ордеров

### Ордер‑менеджмент
- Начальный вход от EMA‑пояса и/или трейлинга
- Ре‑энтри (усреднения) от средней цены позиции по `entry_grid_spacing_pct`
- ТП‑сетка по диапазону markup (`close_grid_markup_*`), либо трейлинг‑закрытия
- Переоценка ордеров по таймингу и изменениям входных условий

### Риск и разгрузка (unstuck)
- `total_wallet_exposure_limit` ограничивает суммарную экспозицию на сторону
- `enforce_exposure_limit` при превышении лимита частично сокращает позицию
- `unstuck_*` позволяет дробно закрывать «застрявшие» позиции, сохраняя контроль риска

### Логи и диагностика
- Логи Python: stdout/stderr, `docker compose logs -f passivbot-live`
- Dozzle (если включён): веб‑интерфейс просмотра логов контейнеров


