# Управление рисками

## Кредитное плечо

На рынках бессрочных фьючерсов с кредитным плечом Passivbot может использовать более 100% средств кошелька.

Passivbot использует только (неплечевой) баланс кошелька в своих расчетах, поэтому изменение кредитного плеча на бирже не повлияет на риск, прибыль или поведение бота, при условии что плечо установлено достаточно высоко для того, чтобы бот мог размещать свои ордера согласно конфигурации. Практически это означает, что кредитное плечо должно быть установлено как минимум выше чем `total_wallet_exposure_limit_long + total_wallet_exposure_limit_short`, чтобы у бота было достаточно маржи для размещения ордеров. В противном случае бот может столкнуться с ошибками "недостаточно маржи".

## Экспозиция кошелька

Для измерения риска позиции Passivbot находит соотношение размера позиции (в котируемой валюте) к общему неплечевому балансу.
Формула для экспозиции кошелька:

`wallet_exposure = (position_size * position_price) / unleveraged_wallet_balance`

wallet_exposure==0.0 означает отсутствие позиции
wallet_exposure==1.0 означает 100% неплечевого баланса кошелька в позиции
wallet_exposure==4.0 означает 400% неплечевого баланса кошелька в позиции
 
Например, если баланс кошелька $1000, размер длинной позиции 100.0 и цена позиции 35.0,
то wallet_exposure равен `100 * 35 / 1000 == 3.5`

## Лимит экспозиции кошелька

`wallet_exposure_limit` - это лимит, за пределы которого бот не позволит расти экспозиции кошелька позиции.

Например, если wallet_exposure_limit=0.6, бот не будет делать дополнительные входы, когда экспозиция кошелька позиции >= 0.6.

## Общий лимит экспозиции кошелька

Пользователь устанавливает `total_wallet_exposure_limit` отдельно для длинных и коротких позиций. Лимит экспозиции кошелька одной позиции равен `total_wallet_exposure_limit / n_positions`.

## Банкротство и ликвидация

Банкротство определяется как когда `equity == (balance + unrealized_pnl) == 0.0`, то есть когда общий долг равен общим активам.

Ликвидация происходит, когда биржа принудительно закрывает позицию, чтобы избежать отрицательного собственного капитала.
Обычно это происходит до фактического банкротства, чтобы биржа могла покрыть расходы на проскальзывание.

Цену банкротства можно рассчитать из позиции и баланса.

Например:
Если wallet_exposure==1.0, цена банкротства равна нулю.
Если wallet_exposure==2.0, цена банкротства на 50% ниже цены позиции.
Если wallet_exposure==3.0, цена банкротства на 33.33% ниже цены позиции.
Если wallet_exposure==10.0, цена банкротства на 10% ниже цены позиции.

## Застревание

Когда у бота больше нет доступных входов и достигнут или превышен `wallet_exposure_limit`, это называется "застреванием".

Если длинная позиция застряла и цена продолжает падать, расстояние между ценой позиции и рыночной ценой становится больше, и закрытие позиции с прибылью становится менее вероятным. Поэтому желательно приблизить цену позиции к движению цены так, чтобы позиция могла быть закрыта с прибылью при небольшом отскоке.
Для достижения этого позиция должна быть увеличена. Однако чем больше размер позиции, тем выше риск ликвидации, если цена продолжит двигаться в неправильном направлении.

## Диверсификация

Хотя корреляция наблюдается на большинстве рынков в целом и на криптовалютных рынках в частности (например, если цена биткоина обваливается, большинство других криптовалют, как правило, следуют за ним), также наблюдается, что "мертвая кошка" часто отскакивает в немного разное время и на разной высоте. Поэтому диверсификация на несколько монет помогает снизить риск того, что одна плохая монета уничтожит весь счет.

Тысяча подбрасываний монеты сойдется к 500 орлам и 500 решкам. Один бросок монеты будет либо орлом, либо решкой. Поэтому может быть более желательно оказаться с 3 из 10 застрявших ботов, каждый с wallet_exposure==0.1, чем с 1 единственным застрявшим ботом с wallet_exposure==1.0.
